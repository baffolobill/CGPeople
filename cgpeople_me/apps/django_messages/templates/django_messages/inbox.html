{% extends "django_messages/base.html" %}
{% load markdown_deux_tags %}

{% block content %}
<h1 id="page_title" class="clearfix clear">Messages</h1>
{% if message_list %}
<section id="unread_messages" class="messages clearfix clear">
    {% for msg in message_list %}
    <article class="message clearfix" id="msg_{{ msg.id }}">
        <header class="two columns omega">
        {% if msg.sender %}
        <a href="{{ msg.sender.profile.get_absolute_url }}">{{ msg.sender.profile.name }}</a>
        {% else %}
        {{ msg.sender_name }}
        {% endif %}
        </header>
        <time datetime="{{ msg.sent_at|date:"F j, Y, P" }}" class="">{{ msg.sent_at|date:"m/j/y P" }}</time>
        <section class="message__body clearfix">
            <article class="preview">
                {{ msg.message|truncatechars:140|markdown }}
            </article>
            <article class="full" style="display:none">
                {{ msg.message|markdown }}

                {% if msg.sender %}
                <section class="message_form clearfix">
                    <form action="/messages/compose/{{ msg.sender.username }}/" method="POST">{% csrf_token %}
                        <input type="hidden" name="name" value="{{ msg.recipient.username }}" id="id_name">
                        <input type="hidden" name="email" value="{{ msg.recipient.email }}" id="id_email">
                        <p id="message_fieldset">
                            <label for="id_message"><span class="req">*</span>Message</label>
                            <textarea name="message" required rows="4" id="id_message" cols="40"></textarea>
                        </p>

                        <input type="hidden" name="user_id" value="{{ msg.sender.id }}" required id="id_user_id">

                        <div style="display: none;">
                            <label>leave this field blank to prove your humanity
                                <input type="text" name="winnie_the_pooh" value="" />
                            </label>
                        </div>

                        <button class="positive">Send</button>
                        <button class="negative">Cancel</button>
                        <input type="submit" style="display:none">
                    </form>
                </section>
                {% endif %}

                <p><a href="#" class="hide">Close</a></p>
            </article>
        </section>
        <div class="controls clearfix">
            <button data-url="/messages/delete/{{ msg.id }}/" class="delete right">Delete</button>
        </div>
    </article>
    {% endfor %}
</section>
{% else %}
    <p>No messages.</p>
{% endif %}
{% endblock %}
